<!DOCTYPE html>
<!-- saved from url=(0034)http://bost.ocks.org/mike/treemap/ -->
<html class="ocks-org do-not-copy"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8">
<title>Zoomable Treemaps</title>
<style>

@import url(../style.css?aea6f0a);

#chart {
  width: 960px;
  height: 500px;
  background: #ddd;
}

text {
  pointer-events: none;
}

.grandparent text {
  font-weight: bold;
}

rect {
  fill: none;
  stroke: #fff;
}

rect.parent,
.grandparent rect {
  stroke-width: 2px;
}

.grandparent rect {
  fill: orange;
}

.grandparent:hover rect {
  fill: #ee9700;
}

.children rect.parent,
.grandparent rect {
  cursor: pointer;
}

.children rect.parent {
  fill: #bbb;
  fill-opacity: .5;
}

.children:hover rect.child {
  fill: #bbb;
}

</style>

</head><body><header>
  <aside>June 8, 2012</aside>
  <a href="http://bost.ocks.org/mike/" rel="author">Mike Bostock</a>
</header>

<h1>Zoomable Treemaps</h1>

<p id="chart">

<svg width="960" height="500" style="margin-left: 0px;"><g transform="translate(0,20)" style="shape-rendering: crispedges;"><g class="depth"><g class="children"><rect class="child" x="809.5583976800581" y="466.8142937805161" width="150.44160231994192" height="13.185706219483905"></rect><rect class="parent" x="809.5583976800581" y="466.8142937805161" width="150.44160231994192" height="13.185706219483905"><title>4,116</title></rect><text dy=".75em" x="815.5583976800581" y="472.8142937805161">flex</text></g><g class="children"><rect class="child" x="903.2185804607211" y="452.1136070964816" width="56.781419539278886" height="14.700686684034508"></rect><rect class="child" x="903.2185804607211" y="421.3626903203516" width="56.781419539278886" height="30.75091677612994"></rect><rect class="child" x="809.5583976800581" y="421.3626903203516" width="93.66018278066304" height="45.451603460164506"></rect><rect class="child" x="809.5583976800581" y="389.11601422576354" width="150.44160231994192" height="32.246676094588054"></rect><rect class="parent" x="809.5583976800581" y="389.11601422576354" width="150.44160231994192" height="77.69827955475256"><title>24,254</title></rect><text dy=".75em" x="815.5583976800581" y="395.11601422576354">display</text></g><g class="children"><rect class="child" x="799.0935947039396" y="465.3088563094694" width="10.464802976118449" height="14.691143690530623"></rect><rect class="child" x="763.5985576501464" y="465.3088563094694" width="35.495037053793226" height="14.691143690530623"></rect><rect class="child" x="763.5985576501464" y="451.29931457460214" width="45.959840029911675" height="14.009541734867241"></rect><rect class="child" x="735.371122103825" y="451.29931457460214" width="28.22743554632143" height="28.700685425397864"></rect><rect class="child" x="698.2103161169072" y="451.29931457460214" width="37.16080598691781" height="28.700685425397864"></rect><rect class="child" x="650.8231518624641" y="451.29931457460214" width="47.387164254443064" height="28.700685425397864"></rect><rect class="child" x="732.1864940133894" y="389.11601422576354" width="77.37190366666869" height="62.1833003488386"></rect><rect class="child" x="650.8231518624641" y="389.11601422576354" width="81.36334215092529" height="62.1833003488386"></rect><rect class="parent" x="650.8231518624641" y="389.11601422576354" width="158.73524581759398" height="90.88398577423646"><title>29,934</title></rect><text dy=".75em" x="656.8231518624641" y="395.11601422576354">physics</text></g><g class="children"><rect class="child" x="942.8641027754342" y="372.63489326359235" width="17.135897224565838" height="16.48112096217119"></rect><rect class="child" x="920.2891665000678" y="372.63489326359235" width="22.574936275366326" height="16.48112096217119"></rect><rect class="child" x="920.2891665000678" y="351.2871084532396" width="39.710833499932164" height="21.34778481035272"></rect><rect class="child" x="892.7068904245615" y="351.2871084532396" width="27.582276075506343" height="37.82890577252391"></rect><rect class="child" x="850.3843402523526" y="351.2871084532396" width="42.322550172208935" height="37.82890577252391"></rect><rect class="child" x="807.9471293481903" y="351.2871084532396" width="42.43721090416227" height="37.82890577252391"></rect><rect class="child" x="807.9471293481903" y="293.12853350392743" width="152.0528706518097" height="58.1585749493122"></rect><rect class="parent" x="807.9471293481903" y="293.12853350392743" width="152.0528706518097" height="95.98748072183605"><title>30,284</title></rect><text dy=".75em" x="813.9471293481903" y="299.12853350392743">data</text></g><g class="children"><rect class="child" x="765.8572515580792" y="374.0473691356625" width="42.08987779011113" height="15.068645090100972"></rect><rect class="child" x="765.8572515580792" y="353.9405752312422" width="42.08987779011113" height="20.106793904420442"></rect><rect class="child" x="740.9074900164801" y="353.9405752312422" width="24.94976154159906" height="35.17543899452136"></rect><rect class="child" x="712.0666069604307" y="353.9405752312422" width="28.840883056049393" height="35.17543899452136"></rect><rect class="child" x="766.151735145864" y="325.8625526214399" width="41.79539420232629" height="28.078022609802247"></rect><rect class="child" x="712.0666069604307" y="325.8625526214399" width="54.08512818543329" height="28.078022609802247"></rect><rect class="child" x="650.8231518624641" y="359.4487399973111" width="61.2434550979666" height="29.667274228452357"></rect><rect class="child" x="650.8231518624641" y="325.8625526214399" width="61.2434550979666" height="33.58618737587125"></rect><rect class="child" x="736.7024772629738" y="293.12853350392743" width="71.24465208521644" height="32.734019117512446"></rect><rect class="child" x="650.8231518624641" y="293.12853350392743" width="85.87932540050974" height="32.734019117512446"></rect><rect class="parent" x="650.8231518624641" y="293.12853350392743" width="157.1239774857262" height="95.98748072183605"><title>31,294</title></rect><text dy=".75em" x="656.8231518624641" y="299.12853350392743">scale</text></g><g class="children"><rect class="child" x="861.8393688018973" y="258.3970213086104" width="98.16063119810269" height="34.73151219531701"></rect><rect class="child" x="650.8231518624641" y="258.3970213086104" width="211.0162169394332" height="34.73151219531701"></rect><rect class="child" x="650.8231518624641" y="217.1902745340848" width="309.1768481375359" height="41.20674677452561"></rect><rect class="parent" x="650.8231518624641" y="217.1902745340848" width="309.1768481375359" height="75.93825896984262"><title>48,716</title></rect><text dy=".75em" x="656.8231518624641" y="223.1902745340848">analytics</text></g><g class="children"><rect class="child" x="623.5970188257079" y="466.1751301595291" width="27.226133036756437" height="13.82486984047091"></rect><rect class="child" x="596.0222797321428" y="466.1751301595291" width="27.574739093564972" height="13.82486984047091"></rect><rect class="child" x="623.4227157973036" y="451.3476934222301" width="27.400436065160648" height="14.827436737298967"></rect><rect class="child" x="596.0222797321428" y="451.3476934222301" width="27.400436065160648" height="14.827436737298967"></rect><rect class="child" x="565.3418651324787" y="466.0037252407933" width="30.680414599664232" height="13.996274759206699"></rect><rect class="child" x="565.3418651324787" y="451.3476934222301" width="30.680414599664232" height="14.656031818563179"></rect><rect class="child" x="531.7515208586137" y="466.08275544294605" width="33.590344273864844" height="13.917244557053948"></rect><rect class="child" x="531.7515208586137" y="451.3476934222301" width="33.590344273864844" height="14.73506202071593"></rect><rect class="child" x="612.7022255073496" y="437.428314651083" width="38.12092635511465" height="13.919378771147137"></rect><rect class="child" x="573.7849491920463" y="437.428314651083" width="38.9172763153033" height="13.919378771147137"></rect><rect class="child" x="531.7515208586137" y="437.428314651083" width="42.03342833343254" height="13.919378771147137"></rect><rect class="child" x="496.11380509514913" y="458.9846254662589" width="35.6377157634646" height="21.015374533741124"></rect><rect class="child" x="496.11380509514913" y="437.428314651083" width="35.6377157634646" height="21.55631081517589"></rect><rect class="child" x="605.621505799188" y="420.1984016066764" width="45.20164606327626" height="17.229913044406544"></rect><rect class="child" x="553.1473176712756" y="420.1984016066764" width="52.47418812791227" height="17.229913044406544"></rect><rect class="child" x="496.11380509514913" y="420.1984016066764" width="57.03351257612644" height="17.229913044406544"></rect><rect class="child" x="450.7817180208069" y="450.9550281225671" width="45.33208707434221" height="29.044971877432886"></rect><rect class="child" x="450.7817180208069" y="420.1984016066764" width="45.33208707434221" height="30.756626515890673"></rect><rect class="child" x="589.2953138477528" y="394.8197037791335" width="61.52783801471139" height="25.378697827542908"></rect><rect class="child" x="520.6082181381198" y="394.8197037791335" width="68.68709570963301" height="25.378697827542908"></rect><rect class="child" x="450.7817180208069" y="394.8197037791335" width="69.82650011731289" height="25.378697827542908"></rect><rect class="child" x="384.1936527735373" y="452.8731625256345" width="66.58806524726964" height="27.126837474365516"></rect><rect class="child" x="384.1936527735373" y="424.7113363215907" width="66.58806524726964" height="28.16182620404379"></rect><rect class="child" x="384.1936527735373" y="394.8197037791335" width="66.58806524726964" height="29.891632542457216"></rect><rect class="child" x="302.86670487106016" y="455.46044200287963" width="81.32694790247712" height="24.53955799712037"></rect><rect class="child" x="302.86670487106016" y="425.2200738649165" width="81.32694790247712" height="30.240368137963117"></rect><rect class="child" x="302.86670487106016" y="394.8197037791335" width="81.32694790247712" height="30.400370085783038"></rect><rect class="child" x="479.49571980971984" y="355.7303150094739" width="171.32743205274426" height="39.08938876965959"></rect><rect class="child" x="302.86670487106016" y="355.7303150094739" width="176.62901493865968" height="39.08938876965959"></rect><rect class="parent" x="302.86670487106016" y="355.7303150094739" width="347.95644699140394" height="124.26968499052612"><title>89,721</title></rect><text dy=".75em" x="308.86670487106016" y="361.7303150094739">query</text></g><g class="children"><rect class="child" x="635.6010005513842" y="341.5146792898054" width="15.222151311079983" height="14.215635719668512"></rect><rect class="child" x="600.3086631018657" y="341.5146792898054" width="35.2923374495183" height="14.215635719668512"></rect><rect class="child" x="562.4736500435924" y="341.5146792898054" width="37.835013058273375" height="14.215635719668512"></rect><rect class="child" x="562.4736500435924" y="313.27978654805406" width="88.34950181887177" height="28.23489274175131"></rect><rect class="child" x="499.6458238979184" y="313.27978654805406" width="62.82782614567407" height="42.45052846141982"></rect><rect class="child" x="576.8804500429885" y="276.8257618442139" width="73.9427018194757" height="36.45402470384016"></rect><rect class="child" x="499.6458238979184" y="276.8257618442139" width="77.23462614507014" height="36.45402470384016"></rect><rect class="child" x="406.76256155066596" y="324.56698586430707" width="92.88326234725241" height="31.163329145166756"></rect><rect class="child" x="406.76256155066596" y="276.8257618442139" width="92.88326234725241" height="47.74122402009317"></rect><rect class="child" x="302.86670487106016" y="276.8257618442139" width="103.8958566796058" height="78.90455316525998"></rect><rect class="child" x="489.39547561169087" y="217.1902745340848" width="161.42767625077323" height="59.63548731012909"></rect><rect class="child" x="302.86670487106016" y="217.1902745340848" width="186.5287707406307" height="59.63548731012909"></rect><rect class="parent" x="302.86670487106016" y="217.1902745340848" width="347.95644699140394" height="138.54004047538908"><title>100,024</title></rect><text dy=".75em" x="308.86670487106016" y="223.1902745340848">animate</text></g><g class="children"><rect class="child" x="290.6839935520811" y="466.7475298917009" width="12.182711318979045" height="13.252470108299121"></rect><rect class="child" x="276.75569971575516" y="466.7475298917009" width="13.928293836325906" height="13.252470108299121"></rect><rect class="child" x="276.75569971575516" y="450.61569301892416" width="26.11100515530495" height="16.131836872776717"></rect><rect class="child" x="252.38324138611728" y="450.61569301892416" width="24.372458329637936" height="29.384306981075838"></rect><rect class="child" x="252.38324138611728" y="428.42949112677974" width="50.48346348494289" height="22.18620189214448"></rect><rect class="child" x="200.4325613578318" y="428.42949112677974" width="51.95068002828549" height="51.57050887322026"></rect><rect class="child" x="252.9068209811287" y="365.1766929065833" width="49.95988388993146" height="63.25279822019644"></rect><rect class="child" x="200.4325613578318" y="365.1766929065833" width="52.474259623296916" height="63.25279822019644"></rect><rect class="child" x="131.28269393802276" y="422.73122219201184" width="69.149867419809" height="57.26877780798816"></rect><rect class="child" x="131.28269393802276" y="365.1766929065833" width="69.149867419809" height="57.55452928542854"></rect><rect class="child" x="219.97922018712114" y="310.83504607839507" width="82.88748468393896" height="54.34164682818823"></rect><rect class="child" x="131.28269393802276" y="310.83504607839507" width="88.69652624909841" height="54.34164682818823"></rect><rect class="child" x="69.80224570160145" y="397.0088337734925" width="61.48044823642131" height="82.99116622650752"></rect><rect class="child" x="69.80224570160145" y="310.83504607839507" width="61.48044823642131" height="86.17378769509747"></rect><rect class="child" x="0" y="397.519915940268" width="69.80224570160145" height="82.48008405973195"></rect><rect class="child" x="0" y="310.83504607839507" width="69.80224570160145" height="86.68486986187298"></rect><rect class="child" x="211.74782418078303" y="217.1902745340848" width="91.11888069027714" height="93.64477154431026"></rect><rect class="child" x="113.35693115413977" y="217.1902745340848" width="98.39089302664325" height="93.64477154431026"></rect><rect class="child" x="0" y="217.1902745340848" width="113.35693115413977" height="93.64477154431026"></rect><rect class="parent" x="0" y="217.1902745340848" width="302.86670487106016" height="262.8097254659152"><title>165,157</title></rect><text dy=".75em" x="6" y="223.1902745340848">util</text></g><g class="children"><rect class="child" x="741.421697882969" y="201.73171942291182" width="218.57830211703083" height="15.458555111172984"></rect><rect class="child" x="741.421697882969" y="165.26267056557307" width="218.57830211703083" height="36.46904885733875"></rect><rect class="child" x="426.9236151884888" y="165.26267056557307" width="314.4980826944803" height="51.92760396851173"></rect><rect class="child" x="722.0055419958727" y="92.35590594992935" width="237.9944580041273" height="72.9067646156437"></rect><rect class="child" x="426.9236151884888" y="92.35590594992935" width="295.0819268073838" height="72.9067646156437"></rect><rect class="child" x="0" y="92.35590594992935" width="426.9236151884888" height="124.83436858415546"></rect><rect class="child" x="0" y="0" width="960" height="92.35590594992935"></rect><rect class="parent" x="0" y="0" width="960" height="217.1902745340848"><title>432,629</title></rect><text dy=".75em" x="6" y="6">vis</text></g></g><g class="grandparent"><rect y="-20" width="960" height="20"></rect><text x="6" y="-14" dy=".75em">flare</text></g></g></svg></p><aside>Click any cell to zoom in, or the top orange label to zoom out.</aside>

<p>Treemaps are a form of <a href="http://mbostock.github.com/d3/ex/treemap.html">space</a><a href="http://mbostock.github.com/d3/ex/pack.html">-filling</a> <a href="http://mbostock.github.com/d3/ex/sunburst.html">layout</a> where the area of each rectangle is proportional to its value. This example shows the size of files in a source tree.

</p><p>Treemaps visualize hierarchical data, but since often only the leaf nodes (files rather than folders) are drawn, it can be difficult to see the hierarchy. <a href="http://en.wikipedia.org/wiki/File:Tree_Map.png">Padding</a> is sometimes used to show the hierarchy via containment, though this introduces area distortion. <a href="http://www.win.tue.nl/~vanwijk/ctm.pdf">Cushion gradients</a> also indicate hierarchy, but are somewhat unintuitive (or perhaps just ugly).

</p><p>The treemap above uses interaction to reveal the hierarchy incrementally: clicking on a node zooms in. Only two levels of the hierarchy are visible at a time. This allows the layout’s aspect ratio (ideally φ) to be optimized for the current view, rather than computing a global layout. It also allows the exploration of arbitrarily-large datasets: data can be lazily-loaded and positioned on zoom!

</p><p>This visualization is implemented in <a href="http://d3js.org/">D3.js</a>, based on an <a href="http://mbostock.github.com/d3/talk/20111018/treemap.html">earlier version</a> from my talk at SVG Open. Also see Nicolas Garcia Belmonte’s zoomable treemap of <a href="http://thejit.org/static/v20/Jit/Examples/Treemap/example1.html">music albums</a>, and The New York Times’ free-form zooming for <a href="http://www.nytimes.com/packages/html/newsgraphics/2011/0119-budget/">Obama’s 2012 budget proposal</a>. Note the subtle differences in behavior!

</p><footer>
  <aside>June 8, 2012</aside>
  <a href="http://bost.ocks.org/mike/" rel="author">Mike Bostock</a>
</footer>

<script src="./Zoomable Treemaps_files/d3.v3.min.js"></script>
<script>

var margin = {top: 20, right: 0, bottom: 0, left: 0},
    width = 960,
    height = 500 - margin.top - margin.bottom,
    formatNumber = d3.format(",d"),
    transitioning;

var x = d3.scale.linear()
    .domain([0, width])
    .range([0, width]);

var y = d3.scale.linear()
    .domain([0, height])
    .range([0, height]);

var treemap = d3.layout.treemap()
    .children(function(d, depth) { return depth ? null : d._children; })
    .sort(function(a, b) { return a.value - b.value; })
    .ratio(height / width * 0.5 * (1 + Math.sqrt(5)))
    .round(false);

var svg = d3.select("#chart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.bottom + margin.top)
    .style("margin-left", -margin.left + "px")
    .style("margin.right", -margin.right + "px")
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .style("shape-rendering", "crispEdges");

var grandparent = svg.append("g")
    .attr("class", "grandparent");

grandparent.append("rect")
    .attr("y", -margin.top)
    .attr("width", width)
    .attr("height", margin.top);

grandparent.append("text")
    .attr("x", 6)
    .attr("y", 6 - margin.top)
    .attr("dy", ".75em");

d3.json("flare.json", function(root) {
  initialize(root);
  accumulate(root);
  layout(root);
  display(root);

  function initialize(root) {
    root.x = root.y = 0;
    root.dx = width;
    root.dy = height;
    root.depth = 0;
  }

  // Aggregate the values for internal nodes. This is normally done by the
  // treemap layout, but not here because of our custom implementation.
  // We also take a snapshot of the original children (_children) to avoid
  // the children being overwritten when when layout is computed.
  function accumulate(d) {
    return (d._children = d.children)
        ? d.value = d.children.reduce(function(p, v) { return p + accumulate(v); }, 0)
        : d.value;
  }

  // Compute the treemap layout recursively such that each group of siblings
  // uses the same size (1×1) rather than the dimensions of the parent cell.
  // This optimizes the layout for the current zoom state. Note that a wrapper
  // object is created for the parent node for each group of siblings so that
  // the parent’s dimensions are not discarded as we recurse. Since each group
  // of sibling was laid out in 1×1, we must rescale to fit using absolute
  // coordinates. This lets us use a viewport to zoom.
  function layout(d) {
    if (d._children) {
      treemap.nodes({_children: d._children});
      d._children.forEach(function(c) {
        c.x = d.x + c.x * d.dx;
        c.y = d.y + c.y * d.dy;
        c.dx *= d.dx;
        c.dy *= d.dy;
        c.parent = d;
        layout(c);
      });
    }
  }

  function display(d) {
    grandparent
        .datum(d.parent)
        .on("click", transition)
      .select("text")
        .text(name(d));

    var g1 = svg.insert("g", ".grandparent")
        .datum(d)
        .attr("class", "depth");

    var g = g1.selectAll("g")
        .data(d._children)
      .enter().append("g");

    g.filter(function(d) { return d._children; })
        .classed("children", true)
        .on("click", transition);

    g.selectAll(".child")
        .data(function(d) { return d._children || [d]; })
      .enter().append("rect")
        .attr("class", "child")
        .call(rect);

    g.append("rect")
        .attr("class", "parent")
        .call(rect)
      .append("title")
        .text(function(d) { return formatNumber(d.value); });

    g.append("text")
        .attr("dy", ".75em")
        .text(function(d) { return d.name; })
        .call(text);

    function transition(d) {
      if (transitioning || !d) return;
      transitioning = true;

      var g2 = display(d),
          t1 = g1.transition().duration(750),
          t2 = g2.transition().duration(750);

      // Update the domain only after entering new elements.
      x.domain([d.x, d.x + d.dx]);
      y.domain([d.y, d.y + d.dy]);

      // Enable anti-aliasing during the transition.
      svg.style("shape-rendering", null);

      // Draw child nodes on top of parent nodes.
      svg.selectAll(".depth").sort(function(a, b) { return a.depth - b.depth; });

      // Fade-in entering text.
      g2.selectAll("text").style("fill-opacity", 0);

      // Transition to the new view.
      t1.selectAll("text").call(text).style("fill-opacity", 0);
      t2.selectAll("text").call(text).style("fill-opacity", 1);
      t1.selectAll("rect").call(rect);
      t2.selectAll("rect").call(rect);

      // Remove the old node when the transition is finished.
      t1.remove().each("end", function() {
        svg.style("shape-rendering", "crispEdges");
        transitioning = false;
      });
    }

    return g;
  }

  function text(text) {
    text.attr("x", function(d) { return x(d.x) + 6; })
        .attr("y", function(d) { return y(d.y) + 6; });
  }

  function rect(rect) {
    rect.attr("x", function(d) { return x(d.x); })
        .attr("y", function(d) { return y(d.y); })
        .attr("width", function(d) { return x(d.x + d.dx) - x(d.x); })
        .attr("height", function(d) { return y(d.y + d.dy) - y(d.y); });
  }

  function name(d) {
    return d.parent
        ? name(d.parent) + "." + d.name
        : d.name;
  }
});

</script>
<script>

GoogleAnalyticsObject = "ga", ga = function() { ga.q.push(arguments); }, ga.q = [], ga.l = +new Date;
ga("create", "UA-48272912-3", "ocks.org");
ga("send", "pageview");

</script>
<script async="" src="./Zoomable Treemaps_files/analytics.js"></script>
</body></html>